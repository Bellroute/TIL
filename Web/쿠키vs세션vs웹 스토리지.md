# 쿠키 vs 세션 vs 웹 스토리지

HTTP 프로토콜은 다음과 같은 특징을 가진다.

- 비연결지향 (Connectionless): 클라이언트가 서버에게 Request를 보내고 서버가 클라이언트에게 Response를 보내면 접속을 종료한다.
- 무상태 (Stateless): 통신이 끝나면 상태 정보를 유지하지 않는다.

즉, 클라이언트의 로그인 정보나 브라우저에서 입력한 값 등이 페이지를 이동할 때 마다 초기화 되는 것이다. 웹 개발을 하다보면 데이터베이스에는 저장하지 않지만, 사용자가 설정한 값을 어딘가에 저장해야하는 경우가 생긴다. (아이디 자동저장, 장바구니 등) 이를 해결하기 위해 등장한 것이 바로 쿠키와 세션, 웹 스토리지이다.





### 쿠키(Cookie)

쿠키는 클라이언트 로컬에 저장되는 **키와 값 형태의 작은 파일(4kb 용량 제한)로 이름, 값, 만료 시간, 경로 정보**가 들어 있다.

쿠키의 주로 세 가지 목적을 위해 사용된다.

- **세션 관리**: 서버에 저장해야할 로그인, 장바구니, 게임 스코어 등의 정보 관리
- **사용자 맞춤**: 사용자가 선호하는 옵션이나 테마 등의 세팅
- **사용자 추적**: 사용자의 행동을 기록하고 분석하는 용도

**Response Header**의 ```Set-Cookie```속성을 사용하면 클라이언트에 쿠키를 만들 수 있으며 만들어진 쿠키는 클라이언트가 따로 설정하지 않아도 브라우저가 **Request Header**에 넣어서 서버로 전송하게 된다.



만들어진 쿠키는 스코프에 의해 두가지로 나뉜다.

- **Session Cookie**: 클라이언트가 종료되면 삭제되는 휘발성 쿠키
- **Permanent Cookie**: 클라이언트가 종료되어도 일정 기간 유지되는 쿠키

**Permanent Cookie**는 ```Expires(날짜와 시간)``` 혹은 ```Max-Age(초)```를 명시해 해당 날짜, 혹은 시간까지 쿠키를 유지할 수 있고 아무것도 명시하지 않을 경우 **Session Cookie**가 된다. (명시된 만료일, 시간은 서버가 아닌 클라이언트를 기준으로 계산됨)



이름과 값에 더해 쿠키는 여러 개의 속성이 있다. 쿠키 속성은 쿠키를 삭제하고 쿠키를 막을 때나 쿠키를 다시 서버로 보낼 것인지를 결정하기 위해 브라우저에서 사용한다.

- **Expires와 Max-Age** : 브라우저가 쿠키를 지워야하는 날짜와 시간, 초를 지정한다. (날짜/시간은 Wdym, DD Mon YYYY HH:MM:SS GMT형태로 지정한다.)
- **Domain과 Path**: Domain과 Path 속성은 쿠키의 범위를 정의한다. 이 속성은 어떤 웹 사이트가 근본적으로 쿠키를 소유하는지를 브라우저에게 알려준다. 명백한 보안 이유로 이 쿠키는 현재 자원의 최상위 도메인과 그 하위 도메인으로만 설정할 수 있으며, 다른 도메인이나 그 하위 도메인으로는 설정할 수 없다. 만약 쿠키의 도메인과 경로를 서버에서 설정하지 않았다면 요청온 자원의 도메인과 경로를 기본값으로 한다. (하지만, 도메인을 주지 않아 설정된 쿠키와 도메인으로 설정한 쿠키는 다르다. 전자의 경우는 해당 도메인 요청인 경우에만 보낼 수 있지만 후자의 경우에는 모든 하위 도메인에서도 포함 된다.)
- **Secure와 HttpOnly**: Secure 속성은 암호화된 전송으로 쿠키 통신을 제약한다는 의미이며, 브라우저는 보안/암호화된 연결을 통해서만 쿠키를 사용할 수 있다는 뜻이다. (그렇지만 웹 서버가 보안 연결이 아닐 때 secure 속성으로 쿠키를 설정하면 중간자 공격 방법으로 사용자에게 전달되는 시점에 쿠키를 가로챌 수 있다. 때문에 Secure 속성을 사용하는 쿠키를 보안 연결을 통해서만 설정하도록 해야 한다.) HttpOnly 속성은 브라우저가 HTTP(혹은 HTTPS) 요청이 아닌 채널을 통해서는 쿠키를 노출할 수 없도록 해준다. 인증된 정보를 자바스크립트를 통해 탈취하는 Cross-site 스크립팅(XXS) 공격을 막는데 도움을 준다.





### 세션(Session)

세션이란 일정 시간동안 같은 브라우저로부터 들어오는 일련의 요구를 하나의 상태로 보고 그 상태를 유지하는 기술이다.

클라이언트가 **Request**를 보내면 **Response**에 ```Set-Cookie```를 통해 클라이언트의 **유일한 ID값**을 생성해 부여하고 이를 통해 사용자 정보는 안전한 서버에 존재하며 클라이언트와 서버 간에는 ID 값만을 전달해 보안 위협을 감소시켜 준다.

이 때 클라이언트에 저장되는 쿠키는 세션 종료 시 함께 소멸되는 "Memory Cookie" 타입을 가져 브라우저가 종료되면 세션과 관련된 쿠키도 삭제된다.

세션은 로컬에 저장되는 쿠키와 다르게 데이터가 서버에 저장된다. 때문에 보안 이슈로부터 비교적 안전하지만 세션 기반 인증 방식은 많은 트래픽으로 인해 서버에 부하를 가져다 줄 수 있다. 이와 같은 문제를 해결하기 위해 토큰 기반 인증 방법을 사용하기도 한다.





### 웹 스토리지(Web Storage)

웹 스토리지는 서버가 아닌, 클라이언트에 데이터를 저장할 수 있도록 지원하는 HTML5의 새로운 기능이다. 쿠키와 기능 자체는 유사하지만 4KB 밖에 저장하지 못하는 쿠키와 다르게 웹 스토리지는 약 5MB까지 저장공간을 이용할 수 있다.

웹 스토리지에는 각각의 고유한 특성을 지닌 두 가지의 스토리지가 있다.

- **로컬 스토리지(local Storage)**: 브라우저 자체에 반영구적으로 데이터를 저장하며, 브라우저를 종료해도 데이터가 유지된다. 다만 도메인이 다른 경우 로컬 스토리지에 접근할 수 없다.
- **세션 스토리지(session Storage)**: 각 세션마다 데이터가 개별적으로 저장되며 로컬 스토리지와 다르게 세션을 종료하면 데이터가 자동으로 제거되며 같은 도메인이라도 세션이 다르면 데이터에 접근할 수 없다.



#### [참고 자료]

> - [쿠키, 세션 그리고 웹 스토리지](https://velog.io/@hellozin/쿠키-세션-그리고-웹-스토리지)
>
> - [HTML5 저장소(세션스토리지,로컬스토리지) 및 쿠키](https://useful-coding-dictionary.tistory.com/entry/HTML-5-저장소세션스토리지로컬스토리지-및-쿠키)
> - [HTTP 쿠키 (Wikipedia 번역)]([https://chanwookpark.github.io/cookie/web/%EB%B2%88%EC%97%AD/2016/02/17/http-cookie-wikipedia/#%EC%BF%A0%ED%82%A4-%EC%86%8D%EC%84%B1](https://chanwookpark.github.io/cookie/web/번역/2016/02/17/http-cookie-wikipedia/#쿠키-속성))