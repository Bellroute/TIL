# SQL vs NoSQL

개발을 할 때 기술을 선택함에 있어서 '다들 쓰니까', '좋다고 하더라' 등 정확한 이유도 모른체 따라가는 것은 좋은 개발자로 성장하기에 좋은 모습은 아니라고 생각한다. 좋은 개발자에 한 걸음이라도 가까이 가기 위해 막연하게만 알고 있던 SQL과 NoSQL에 대해 이해하고, 어떤 상황에서 SQL 혹은 NoSQL 데이터베이스를 선택해야하는 지 알아보고자 한다.



### SQL(관계형 데이터베이스)

사실 SQL은 **구조화된 쿼리 언어(Structured Query Language)**라는 뜻으로 관계형 데이터베이스 자체를 나타내는 말이 아니라 데이터베이스를 조작하기 위한 언어를 의미한다. (관계형 데이터베이스 시스템은 RDMBS라고 한다. 이 글에서는 편의상 관계형데이터베이스를 SQL라고도 지칭하겠다.)

관계형 데이터베이스는 두 가지의 주요한 특징을 갖는다.



##### 데이터는 엄격한 스키마(Schema)에 의해 관리된다.

스키마는 데이터베이스에 어떤 구조로, 어떤 제약 조건으로 저장 되어야 하는지 정의한 것이다. 관계형 데이터베이스에서는 데이터를 저장하기 위해서는 이러한 스키마가 먼저 정의되어야 한다. 그리고 정해진 스키마를 준수하지 않은 데이터는 추가할 수 없다. 



##### 데이터는 관계(Relation)를 통해서 연결된 여러 개의 테이블에 분산된다.

RDBMS의 또 다른 중요한 부분은 (이름에서도 언급되었듯이) **관계(Realation)**이다. 이러한 RDBMS의 특징은 데이터들을 중복되지 않고 저장할 수 있도록 한다. 해당 테이블에서 필요한 정보를 가지고 있지 않더라도 정보를 가진 다른 테이블과 join하여 데이터를 불러올 수 있다.



RDBMS는 **ACID**의 특성을 따른다. ACID는 **DB의 트랜잭션이 안정하게 수행됨을 보장하기 위한 특징**이다.

- `Atomicity(원자성)` : 트랜잭션의 작업이 부분적으로 실행되거나 중단하지 않는 것을 보장(불가능한 최소의 단위인 하나의 원자처럼 동작한다는 의미. 끝까지 실행되거나 아예 실행되지 않거나. 0이거나 1이거나..)
- `Consititency(일관성)` : 미리 정의된 규칙에서만 수정이 가능한 특성을 의미(Type safety와 연관)
- `Isolation(고립성)` : 트랜잭션 수행시 다른 트랜잭션의 작업이 끼어들지 못하도록 보장하는 것
- `Durability(영구성)` : 성공적으로 수행된 트랜잭션은 영원히 반영되는 것을 의미



명확하고 엄격한 구조를 가지는 관계형 데이터베이스는 하나의 테이블에서 중복없이 하나의 데이터만을 관리하기 때문에, 다른 테이블에서 부정확한 데이터를 다룰 위험이 없다.





### NoSQL(비관계형 데이터베이스)

NoSQL은 Not Only SQL로 관계형 데이터베이스와 반대되는 접근방식을 따르기 때문에 지어진 이름으로 Not Only Database, Non Realational Database라고도 불린다.

특징 역시 RDBMS와 반대되는 특징을 갖는다.



##### 스키마라는 개념이 없다.

스키마가 없다는 것은 특정 형식에 맞추어 데이터를 관리할 필요 없이 자유롭게 데이터를 관리할 수 있다는 것이다. NoSQL에서는 다른 구조의 데이터를 같은 컬렉션(= 테이블)에 추가할 수 있다.



##### 관계라는 개념도 없다.

NoSQL은 관계의 개념도 존재하지 않아 RDBMS처럼 여러 테이블에 데이터를 나누어 담지 않는다. 일반적인 정보를 모두 포함한 데이터를 하나의 컬렉션에 저장한다. 따라서 여러 테이블/컬렉션을 join할 필요 없이 이미 필요한 정보를 가지고 있게 된다.



NoSQL은 **CAP이론**을 따른다. CAP이론은 분**산 시스템에서는 CAP 세 가지 속성 모두를 만족하는 것은 불가능하며, 오직 2가지만 만족할 수 있다는 것으로 정의**할 수 있다.

- `Consistency(일관성)` : 모든 노드들은 같은 시간에 동일한 항목에 대해 같은 내용의 데이터를 사용자에게 보여준다.
- `Availability(가용성)` : 모든 사용자들이 읽기 및 쓰기가 가능해야하며, 몇몇 노드의 장애 시에도 다른 노드에 영향을 미치면 안된다.
- `Partitions Tolerance(분리 내구성, 생존성)` : 메시지 전달이 실패하거나 시스템 일부가 망가져도 시스템이 계속 동작할 수 있어야 한다.



NoSQL의 이러한 방식은 데이터가 중복되기 때문에 불안정할 수 있지만, 복잡하고 느릴 수 있는 join을 사용할 필요 없다는 강점을 갖는다.





### Scalability(확장성) 측면에서 SQL vs NoSQL

데이터의 확장은 수직적(Vertical) 확장과 수평적(Horizontal) 확장으로 구별할 수 있다.

- `수직적 확장` : 데이터베이스 서버의 성능을 향상 시키는 방법(업그레이드, 하드웨어 추가)
- `수평적 확장` : 더 많은 서버가 추가되고 데이터베이스가 전체적으로 분산되는 방법

데이터가 저장되는 방식 때문에 **SQL 데이터는 일반적으로 수직적 확장**만을 지원한다. **수평적 확장은 NoSQL의 경우에 더 적합**한 확장 방식이다.





### SQL이 NoSQL 보다 나은 점

- 명확하게 정의된 스키마 덕분에 **데이터 무결성**을 보장한다. 
- **데이터 중복을 피할 수 있다.** 데이터가 중복된다면 수정사항에 대해 모든 컬렉션에서 업데이트를 해야한다. 반면, SQL은 중복이 없기 때문에 한 번만 수정하면 된다.



### NoSQL이 SQL 보다 나은 점

- 스키마가 없기 때문에 훨씬 더 **유연**하다. 언제든지 데이터를 조정할 수 있다. SQL에서 스키마를 수정하려는 경우, 이미 가지고 있는 데이터까지 전부 수정해야하는 대공사가 될 수도 있다.
- **데이터를 비교적 간단하고, 빠르게** 읽어올 수 있다.
- **수직 및 수평 확장이 용이**하다. SQL은 수평적 확장이 어려운 반면, NoSQL은 쉽게 가능하다.



### SQL과 NoSQL 중 무엇을 선택해야하는가

##### SQL이 적합한 경우

- 관계를 맺고 있는 데이터가 자주 변경되는 경우 (NoSQL은 수정하려면 중복된 데이터를 모두 수정해야한다.)
- 변경될 여지가 없고, 명확한 스키마가 사용자와 데이터에게 중요한 경우

##### NoSQL이 적합한 경우

- 정확한 데이터 구조를 알 수 없거나 변경/확장 될 수 있는 경우
- 읽기(read)처리를 자주하지만, 데이터를 자주 변경(update)하지 않는 경우
- 데이터베이스를 수평으로 확장해야 하는 경우(즉, 막대한 양의 데이터를 다뤄야 하는 경우)



요즘은 시장이 성숙되어지면서 서로간의 서로의 영역을 침범하는 기능들이 나타나고 있어 각각의 단점을 보완하고 있기도 하다고 한다. (NoSQL - MongoDB의 트랙잭션 지원 및 인덱스 지원, RDBMS - JSON 타입에 대한 지원 추가한 document store 등)





#### [참고]

> - [SQL vs NoSQL (MySQL vs. MongoDB)](https://siyoon210.tistory.com/130)
> - [SQL vs NoSQL](https://velog.io/@thms200/SQL-vs-NoSQL)
> - [RDBMS Vs NoSQL 장단점](https://blog.naver.com/kjun612/221922985512)
> - [CAP 이론](https://m.blog.naver.com/PostView.nhn?blogId=windfalcon1&logNo=220402574806&proxyReferer=https:%2F%2Fwww.google.com%2F)