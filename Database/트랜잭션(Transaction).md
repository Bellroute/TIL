# 트랜잭션(Transaction)

> 트랜잭션(Transaction)은 데이터베이스의 상태를 변환시키는 하나의 논리적 기능을 수행하기 위한 작업의 단위 또는 한꺼번에 모두 수행되어야 할 일련의 연산



트랜잭션은 "쪼갤 수 없는 업무 처리의 최소 단위"를 말한다. 예를 들어, A라는 사람이 B라는 사람에게 1,000원을 지급하고 B가 그 돈을 받은 경우, 이 거래 기록은 더 이상 작게 쪼갤 수가 없는 하나의 트랜잭션을 구성한다. 만약 A는 돈을 지불했지만 B는 받지 못한 경우가 생긴다면 그 거래는 성립되지 않아야한다. 이처럼 A가 돈을 지불하는 행위와 B가 돈을 받는 행위는 별개로 분리될 수 없는 처리의 최소 단위를 트랜잭션이라고 한다. 트랜잭션은 처리가 완료되면 커밋(commit)을 하여 변경된 상태를 저장하지만, 중간에 오류가 발생하면 처음으로 롤백(rollback)함으로써 안정성을 확보한다.

</br>

### 트랜잭션의 성질

데이터베이스의 트랜잭션이 안전하게 수행되기 위해서는 **ACID 조건** 을 충족해야 한다.

#### 원자성(Atomicity)

- 트랜잭션의 연산은 데이터베이스에 모두 반영되든지 아니면 전혀 반영되지 않아야 한다. (ALL-OR-NOTHING. 더 이상 쪼갤 수 없는 상태인 원자의 성질을 가졌다는 의미에서 원자성이라고 함)
- 트랜잭션 내의 모든 명령은 반드시 수행되어야 하며, 어느 하나라도 오류가 발생하면 트랜잭션 전부가 취소되어야 한다.

#### 일관성(Consistency)

- 트랜잭션의 작업 처리 결과가 항상 일관성이 있어야 한다

#### 고립성(Isolation)

- 둘 이상의 트랜잭션이 동시에 병행 실행되는 경우 어느 하나의 트랜잭션 실행 중에 다른 트랜잭션의 연산이 끼어들 수 없다.
- 수행 중인 트랜잭션은 완전히 완료될 때까지 다른 트랜잭션에서 수행 결과를 참조할 수 없다.

#### 지속성, 영구성(Durability)

- 성공적으로 완료된 트랜잭션의 결과는 영구적으로 반영되어야 한다.

</br>

### 트랜잭션의 연산

#### Commit

- 모든 작업들을 정상적으로 처리하겠다고 확정하는 명령어로 처리과정을 DB에 영구 저장하는 것
- commit을 수행하면 이전 데이터가 완전히 업데이트되고 트랜잭션 과정을 종료하게 된다.

</br>

#### Rollback

- 작업 중에 문제가 발생되어 트랜잭션의 처리과정에서 발생한 변경사항을 취소하는 명령어
- 트랜잭션이 시작되기 이전의 상태, 즉 마지막 commit을 완료한 시점으로 다시 돌아간다.

</br>

#### Savepoint

- 일반적으로 Rollback이 발생하면 트랜잭션 작업 전체가 취소된다. 하지만 Savepoint를 지정함으로써 사용자가 트랜잭션 중간 단계에서부터 취소되도록 할 수 있다. (우리가 문서 작업이나 ppt 만들 때 중간중간 저장해둬서 컴터가 꺼지더라도 그 부분까지는 저장될 수 있도록 하는 것과 같은 맥락)

</br>

### 트랜잭션의 상태

![](https://user-images.githubusercontent.com/41420639/91718851-2af9e800-ebcf-11ea-9a9f-c53e646dedd6.png)

1. **활동(Active)** : 트랜잭션이 실행 중에 있는 상태, 연산들이 정상적으로 실행 중인 상태

2. **실패(Failed)** : 트랜잭션 실행에 오류가 발생하여 중단된 상태
3. **철회(Aborted)** : 트랜잭션이 비정상적으로 종료되어 Rollback 연산을 수행한 상태
4. **부분 완료(Partially Committed)** : Commit 연산이 실행되기 직전의 상태로 아직 작성한 것들을 저장하지 않은 상태
5. **완료(Committed)** : 트랜잭션이 성공적으로 종료되어 Commit 연산을 실행한 후의 상태

</br>

#### [참고]

- [[SQL] Transaction(트랜잭션)](https://jerryjerryjerry.tistory.com/48)

- [[DB이론] 트랜잭션(transaction)과 ACID 특성을 보장하는 방법](https://victorydntmd.tistory.com/129)

- [트랜잭션(Transaction)이란?](https://mommoo.tistory.com/62)
- [[DB기초] 트랜잭션이란 무엇인가?](https://coding-factory.tistory.com/226)