# 메모리 관리

#### 메모리 관리가 필요한 이유

- 컴퓨터의 메모리는 한정된 자원이다.
- 여러 프로그램이 동시에 메모리에 적재되어 실행되면서, 메모리를 공유할 필요가 생김

다중 프로그래밍 시스템에서 메모리의 사용자 영역을 여러 프로세스가 상주할 수 있도록 세분화하는 작업을 메모리 관리라고 한다.

#### 메모리 할당

- 메모리는 주소와 데이터로 구성되어 있다. 

- CPU가 원하는 데이터의 주소를 메모리에 보내주게 되면 메모리는 CPU에게 해당하는 데이터를 보내준다. 

- 프로세스가 메모리에 적재되면 그 프로세스를 위한 독자적인 주소 공간이 생성된다. 

- 이 주소를 논리적 주소 혹은 가상 주소라고 부른다.

  -  논리적 주소는 각 프로세스마다 독립적으로 할당되며 0번지부터 시작된다. 
  - 반면, 물리적 주소는 메모리에 실제로 올라가는 위치를 말한다. 

- 프로세스의 논리적 주소를 물리적 주소로 매핑하는 작업을 **주소 바인딩**이라고 한다.

  - 주소 바인딩의 3가지 방식

    1. 컴파일 타임 바인딩 : 컴파일 할 때 물리적 메모리 주소가 결정. 물리적 주소 변경하고 싶으면 다시 컴파일해야함.

    2. 로드 타임 바인딩 : 프로그램의 실행이 시작될 때 물리적 주소 결정. Loader가 메모리 주소를 부여하고, 프로그램이 종료될 때까지 물리 주소가 고정됨

    3. 런 타임 바인딩 : 프로그램이 실행한 후에도 물리적 주소가 변경될 수 있는 방식.

       - 기준 레지스터: 프로세스의 물리적 메모리의 시작 주소를 가지고 있다.

       - 한계 레지스터: 현재 CPU에서 수행중인 프로세스의 논리적 주소의 최대값, 프로세스의 크기를 가지고 있다. 프로세스가 접근해서는 안되는 영역을 방지하기 위함.

       - MMU(Memory Management Unit): 논리적 주소를 물리적 주소로 매핑해주는 하드웨어

`물리적 주소를 바로 사용하지 않고, 논리적 주소를 통해 매핑을 하는 이유가 뭘까?`

- 프로그램이 물리 메모리의 모든 주소에 접근할 수 있다면 운영체제 파괴의 위험 , 시스템 중지의 위험이 있음.

</br>

#### 외부 단편화 vs 내부 단편화

**외부 단편화**

- 프로세스들이 메모리를 차지하는 과정에서 외부에 여러 개로 작게 나누어진 공백이 생겨서 메모리를 할당할 수 없는 상태가 되는 것
- 압축 : 사용가능 메모리를 모아서 하나의 큰 블록으로 만들어서 외부 단편화 문제를 해결하는 방법

**내부 단편화**

- 프로세스를 고정된 크기의 페이지 단위로 분할할 때, 프로세스의 메모리 크기가 페이지 단위와 나누어 떨어지지 않으면 할당된 마지막 프레임이 가득 차지 않는 현상
- EX) 크기 70000KB 프로세스, 2048KB 페이지가 있으면 프로세스는 '34개의 페이지 + 368KB' 로 나누어지고 총 35개의 프레임이 필요하다. 이 때 마지막 프레임은 '2048 - 368 = 1680KB' 만큼의 내부 단편화가 발생한다.

</br>

### 연속 메모리 할당 방식

- 물리적 메모리의 연속적인 공간에 프로세스를 적재하는 방식

#### 고정 분할 기법

- 메모리 영역을 여러 개의 고정된 크기로 분할하여 프로세스에 제공하는 기법
- 내부 단편화 발생

#### 가변 분할 기법

- 각 프로세스의 크기에 따라 메모리를 분할하는 기법
- 외부 단편화 발생

</br>

### 분산 메모리 할당 방식

- 하나의 프로세스를 물리적 메모리의 여러 영역에 분산, 적재하는 방식

#### 페이징(Paging)

- 고정 크기 분할
- 처리할 작업을 동일한 크기의 '페이지'로 나누고 메모리를 '프레임' 단위로 나누어서 할당하여 처리
- 내부 단편화 발생

#### 세그먼테이션(Segmentation)

- 가변 크기 분할
- 서로 다른 크기의 세그먼트 단위로 메모리를 분할하여 프로세스를 할당한다.
- 외부 단편화 발생

</br>

#### [참고]

> - https://getchan.github.io/cs/OS_6/
> - https://velog.io/@byunji_jump/%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C-%EB%A9%94%EB%AA%A8%EB%A6%AC-%EA%B4%80%EB%A6%AC
> - https://skytitan.tistory.com/194
> - https://jinhyy.tistory.com/33
> - https://m.blog.naver.com/PostView.nhn?blogId=bycho211&logNo=221028200599&proxyReferer=https:%2F%2Fwww.google.com%2F
> - https://box0830.tistory.com/98
> - https://velog.io/@adam2/OS%EA%B8%B0%EC%B4%88%EB%A9%94%EB%AA%A8%EB%A6%AC-%EA%B4%80%EB%A6%AC%EC%A3%BC%EC%86%8C-%EB%B0%94%EC%9D%B8%EB%94%A9

